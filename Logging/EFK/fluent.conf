# Input plugin to capture Docker logs
<source>
  @type tail
  path /var/lib/docker/containers/**/*.log
  pos_file /fluentd/log/containers.log.pos
  tag docker.*
  read_from_head true
  <parse>
    @type json
    time_key time
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  </parse>
</source>

# Keep the forward source for any other log inputs
<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Store Data in Elasticsearch
<match **>
  @type elasticsearch
  host elasticsearch
  port 9200
  logstash_format true
  logstash_prefix fluentd
  include_tag_key true
  tag_key @log_name
  flush_interval 5s
  reconnect_on_error true
  reload_on_failure true
  reload_connections false
</match>

# Output logs to stdout for debugging (optional)
<match **>
  @type stdout
</match>
